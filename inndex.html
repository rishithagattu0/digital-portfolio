/*
Interactive Digital Portfolio (Single-file React component)
- Tailwind CSS required (see setup below)
- Optional deps: framer-motion, react-icons

How to use
1. Create a React app (Vite or CRA). Example with Vite:
   npm create vite@latest my-portfolio -- --template react
   cd my-portfolio
2. Install Tailwind (follow Tailwind docs). Minimal commands:
   npm install -D tailwindcss postcss autoprefixer
   npx tailwindcss init -p
   // add content globs and imports per Tailwind docs
3. Install optional libs:
   npm install framer-motion react-icons
4. Replace the placeholder GITHUB_USERNAME below with your GitHub username.
5. Drop this component (Portfolio.jsx) into src/ and import it in App.jsx.

Notes
- This component fetches your public GitHub repos and displays them with filters.
- Replace images/asset links with your own images or host them in the repo.
- The contact form is a simple mailto fallback. For a production contact form use Netlify Forms / Formspree / serverless endpoint.
*/

import React, { useEffect, useState, useMemo } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { FiSun, FiMoon, FiSearch, FiGithub, FiExternalLink } from 'react-icons/fi';

export default function Portfolio() {
  // === CONFIG ===
  const GITHUB_USERNAME = 'your-github-username'; // <- REPLACE this
  const PROJECTS_FALLBACK = [
    {
      id: 'local-1',
      name: 'Example Project',
      description: 'A short description of the project and what it does.',
      topics: ['react', 'tailwind', 'demo'],
      html_url: '#',
      homepage: '#',
    },
  ];

  // === STATE ===
  const [repos, setRepos] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [query, setQuery] = useState('');
  const [activeTag, setActiveTag] = useState('all');
  const [selected, setSelected] = useState(null);
  const [dark, setDark] = useState(false);
  const [sortBy, setSortBy] = useState('pushed'); // pushed | stars | name

  // === EFFECT: fetch GitHub repos ===
  useEffect(() => {
    let mounted = true;
    async function fetchRepos() {
      setLoading(true);
      setError(null);
      try {
        const res = await fetch(`https://api.github.com/users/${GITHUB_USERNAME}/repos?per_page=100`);
        if (!res.ok) throw new Error(`GitHub API returned ${res.status}`);
        const data = await res.json();
        // normalize
        const mapped = data.map((r) => ({
          id: r.id || r.name,
          name: r.name,
          description: r.description,
          topics: r.topics && r.topics.length ? r.topics : extractTagsFromName(r.name),
          html_url: r.html_url,
          homepage: r.homepage,
          stargazers_count: r.stargazers_count || 0,
          pushed_at: r.pushed_at,
        }));
        if (mounted) setRepos(mapped);
      } catch (err) {
        console.error(err);
        if (mounted) {
          setError(err.message);
          setRepos(PROJECTS_FALLBACK);
        }
      } finally {
        if (mounted) setLoading(false);
      }
    }
    fetchRepos();
    return () => (mounted = false);
  }, [GITHUB_USERNAME]);

  function extractTagsFromName(name) {
    return name.split(/[-_.]/).slice(0, 4).map((s) => s.toLowerCase());
  }

  // === FILTERS & SORT ===
  const allTags = useMemo(() => {
    const set = new Set();
    repos.forEach((r) => (r.topics || []).forEach((t) => set.add(t)));
    return ['all', ...Array.from(set).slice(0, 30)];
  }, [repos]);

  const filtered = useMemo(() => {
    let out = repos.slice();
    if (query.trim()) {
      const q = query.toLowerCase();
      out = out.filter((r) => (r.name || '').toLowerCase().includes(q) || (r.description || '').toLowerCase().includes(q));
    }
    if (activeTag !== 'all') out = out.filter((r) => (r.topics || []).includes(activeTag));
    if (sortBy === 'stars') out.sort((a, b) => (b.stargazers_count || 0) - (a.stargazers_count || 0));
    if (sortBy === 'name') out.sort((a, b) => a.name.localeCompare(b.name));
    if (sortBy === 'pushed') out.sort((a, b) => new Date(b.pushed_at || 0) - new Date(a.pushed_at || 0));
    return out;
  }, [repos, query, activeTag, sortBy]);

  // === UI helpers ===
  function toggleDark() {
    setDark((d) => !d);
    document.documentElement.classList.toggle('dark');
  }

  return (
    <div className={`min-h-screen ${dark ? 'bg-slate-900 text-slate-100' : 'bg-white text-slate-900'}`}>
      <div className="container mx-auto px-6 py-12">
        <header className="flex items-center justify-between mb-8">
          <div>
            <h1 className="text-3xl font-extrabold">Rishitha Gattu — Interactive Portfolio</h1>
            <p className="text-sm opacity-80 mt-1">Student at Jyothishmathi Institute of Technology and Science • Aspiring Developer • Tech Enthusiast</p>
          </div>
          <div className="flex items-center gap-3">
            <button onClick={toggleDark} aria-label="toggle-theme" className="p-2 rounded-md hover:bg-slate-100 dark:hover:bg-slate-800">
              {dark ? <FiSun size={18} /> : <FiMoon size={18} />}
            </button>
            <a href={`https://github.com/${GITHUB_USERNAME}`} target="_blank" rel="noreferrer" className="inline-flex items-center gap-2 px-3 py-2 rounded-md border">
              <FiGithub /> GitHub
            </a>
          </div>
        </header>

        <section className="grid md:grid-cols-3 gap-8 mb-12 items-center">
          <div className="md:col-span-2">
            <motion.h2 initial={{ y: 8, opacity: 0 }} animate={{ y: 0, opacity: 1 }} className="text-2xl font-bold mb-2">
              Hi — I'm Rishitha Gattu.
            </motion.h2>
            <p className="leading-relaxed opacity-85">
              I am currently pursuing my degree at Jyothishmathi Institute of Technology and Science. I am passionate about software development, web technologies, and building impactful projects that solve real-world problems. I enjoy exploring new tools and frameworks and continuously expanding my skills in front-end and back-end development.
            </p>
            <p className="leading-relaxed opacity-85 mt-4">
              <strong>Experience:</strong> I have worked on various academic and personal projects involving full-stack web development, UI/UX design, and API integration. I have hands-on experience with technologies like React, Flask, MySQL, and Azure Cognitive Services. I am also exploring the fields of data analysis and machine learning to broaden my career path in the tech industry.
            </p>

            <div className="flex gap-2 mt-6">
              <a href="#projects" className="px-4 py-2 rounded bg-indigo-600 text-white">See projects</a>
              <a href="#contact" className="px-4 py-2 rounded border">Contact</a>
            </div>
          </div>

          <div className="p-4 border rounded-md">
            <div className="flex justify-between items-center">
              <div>
                <p className="text-sm">Public repos</p>
                <h3 className="text-2xl font-semibold">{repos.length ?? '—'}</h3>
              </div>
              <div className="text-right">
                <p className="text-sm">Top language</p>
                <h3 className="text-lg font-medium">JavaScript</h3>
              </div>
            </div>

            <div className="mt-4">
              <input
                aria-label="search"
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                className="w-full px-3 py-2 rounded-md border focus:outline-none"
                placeholder="Search projects..."
              />
            </div>
          </div>
        </section>

        <section id="projects" className="mb-10">
          <div className="flex items-center justify-between mb-4">
            <h3 className="text-xl font-semibold">Projects</h3>
            <div className="flex items-center gap-3">
              <select value={sortBy} onChange={(e) => setSortBy(e.target.value)} className="px-3 py-1 rounded border">
                <option value="pushed">Recently updated</option>
                <option value="stars">Most stars</option>
                <option value="name">Name</option>
              </select>
            </div>
          </div>

          <div className="mb-4 overflow-auto flex gap-2">
            {allTags.map((t) => (
              <button
                key={t}
                onClick={() => setActiveTag(t)}
                className={`px-3 py-1 rounded-full border ${activeTag === t ? 'bg-indigo-600 text-white' : ''}`}
              >
                {t}
              </button>
            ))}
          </div>

          {loading ? (
            <div className="p-8 border rounded text-center">Loading projects...</div>
          ) : error ? (
            <div className="p-8 border rounded text-center text-red-500">Failed to load projects: {error}</div>
          ) : (
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              <AnimatePresence>
                {filtered.map((p) => (
                  <motion.article
                    key={p.id}
                    layout
                    initial={{ opacity: 0, y: 6 }}
                    animate={{ opacity: 1, y: 0 }}
                    exit={{ opacity: 0, y: 6 }}
                    className="p-4 border rounded-md hover:shadow-md cursor-pointer flex flex-col"
                    onClick={() => setSelected(p)}
                  >
                    <div className="flex-1">
                      <h4 className="font-semibold text-lg truncate">{p.name}</h4>
                      <p className="text-sm opacity-80 mt-2 line-clamp-3">{p.description || 'No description provided.'}</p>
                    </div>

                    <div className="mt-3 flex items-center justify-between">
                      <div className="flex gap-2 flex-wrap">
                        {(p.topics || []).slice(0, 3).map((t) => (
                          <span key={t} className="text-xs px-2 py-1 rounded-full border">{t}</span>
                        ))}
                      </div>
                      <div className="flex gap-2 items-center">
                        <a href={p.html_url} target="_blank" rel="noreferrer" onClick={(e) => e.stopPropagation()} className="inline-flex items-center gap-2 px-2 py-1 border rounded">
                          <FiGithub />
                        </a>
                        {p.homepage ? (
                          <a href={p.homepage} target="_blank" rel="noreferrer" onClick={(e) => e.stopPropagation()} className="inline-flex items-center gap-2 px-2 py-1 border rounded">
                            <FiExternalLink />
                          </a>
                        ) : null}
                      </div>
                    </div>
                  </motion.article>
                ))}
              </AnimatePresence>
            </div>
          )}
        </section>

        <AnimatePresence>
          {selected && (
            <motion.div className="fixed inset-0 z-50 flex items-center justify-center p-6" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
              <motion.div initial={{ scale: 0.98 }} animate={{ scale: 1 }} exit={{ scale: 0.98 }} className="max-w-2xl w-full bg-white dark:bg-slate-800 border rounded-lg p-6 shadow-lg">
                <div className="flex items-start justify-between">
                  <div>
                    <h3 className="text-xl font-bold">{selected.name}</h3>
                    <p className="text-sm opacity-80 mt-1">{selected.description}</p>
                  </div>
                  <div className="flex gap-2">
                    <a href={selected.html_url} target="_blank" rel="noreferrer" className="px-3 py-1 rounded border inline-flex items-center gap-2">Open on GitHub <FiGithub /></a>
                    <button onClick={() => setSelected(null)} className="px-3 py-1 rounded border">Close</button>
                  </div>
                </div>

                <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <h4 className="font-semibold">Details</h4>
                    <ul className="mt-2 space-y-1 text-sm opacity-85">
                      <li><strong>Updated:</strong> {selected.pushed_at ? new Date(selected.pushed_at).toLocaleString() : '—'}</li>
                      <li><strong>Stars:</strong> {selected.stargazers_count ?? 0}</li>
                      <li><strong>Topics:</strong> {(selected.topics || []).join(', ') || '—'}</li>
                    </ul>
                  </div>

                  <div>
                    <h4 className="font-semibold">Quick actions</h4>
                    <div className="mt-2 flex gap-2">
                      <a href={`https://github.com/${GITHUB_USERNAME}/${selected.name}/issues/new`} target="_blank" rel="noreferrer" className="px-3 py-2 rounded border">Open issue</a>
                      <a href={`${selected.html_url}#readme`} target="_blank" rel="noreferrer" className="px-3 py-2 rounded border">Open README</a>
                    </div>
                  </div>
                </div>

              </motion.div>
            </motion.div>
          )}
        </AnimatePresence>

        <footer id="contact" className="mt-14 border-t pt-8">
          <div className="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <h4 className="text-lg font-semibold">Let's build something</h4>
              <p className="mt-2 opacity-80">I'm available for freelance and open-source collaboration. Send a message and I'll get back within a few days.</p>

              <div className="mt-4">
                <a href={`mailto:your.email@example.com?subject=Hi`} className="px-4 py-2 rounded bg-indigo-600 text-white inline-block">Email me</a>
              </div>
            </div>

            <div>
              <form onSubmit={(e) => { e.preventDefault(); window.location.href = `mailto:your.email@example.com?subject=Portfolio%20contact&body=${encodeURIComponent(e.target.message.value)}`; }}>
                <label className="block text-sm">Message</label>
                <textarea name="message" rows={4} className="w-full mt-2 px-3 py-2 rounded border" placeholder="Hi — I saw your portfolio..." />
                <div className="mt-3 flex gap-2">
                  <button type="submit" className="px-4 py-2 rounded bg-indigo-600 text-white">Send</button>
                  <button type="reset" className="px-4 py-2 rounded border">Reset</button>
                </div>
              </form>
            </div>
          </div>

          <p className="mt-6 text-sm opacity-70">Built with ❤️ — export this component to your project and customize it. Replace placeholder texts, images, and GITHUB_USERNAME.</p>
        </footer>
      </div>
    </div>
  );
}
